var pathArray = window.location.pathname.split("/");
var parent = pathArray[1];
var child = pathArray[2];
(function ($) {
    $.extend({
        goToByScroll: function (e) {
            $("html,body").animate({
                scrollTop: $("#" + e).offset().top
            }, "fast")
        },
        getMessage: function () {
            return customMessages
        },
        writeCookie: function () {
            if ($.cookie("pixel_ratio") == null && window.devicePixelRatio >= 2) {
                $.cookie("pixel_ratio", window.devicePixelRatio, {
                    path: "/"
                })
            }
        },
        concat: function (e, t) {
            $.each(t, function (t, n) {
                if (e[t] !== undefined) {
                    if (!e[t.push]) {
                        e[t] = [e[t]]
                    }
                    e[t].push(n || "")
                } else {
                    e[t] = n || ""
                }
            });
            return e
        }
    });
    $.fn.preload = function () {
        this.each(function () {
            $("<img/>")[0].src = this
        })
    };
    $.fn.clearForm = function () {
        return this.each(function () {
            var e = this.type,
                t = this.tagName.toLowerCase();
            if (t == "form") return $(":input", this).clearForm();
            if (e == "text" || e == "password" || t == "textarea") this.value = "";
            else if (e == "checkbox" || e == "radio") this.checked = false;
            else if (t == "select") this.selectedIndex = -1
        })
    };
    $.fn.serializeObject = function () {
        var e = {};
        var t = this.serializeArray();
        $.each(t, function () {
            if (e[this.name] !== undefined) {
                if (!e[this.name].push) {
                    e[this.name] = [e[this.name]]
                }
                e[this.name].push(this.value || "")
            } else {
                e[this.name] = this.value || ""
            }
        });
        return e
    };
    $.fn.clearField = function () {
        if ($(this).val() == $(this).attr("title")) {
            $(this).val("");
            $(this).removeClass("grey");
            return false
        } else if ($(this).attr("data-type") == "password") {
            $(this).get(0).type = "password"
        }
        return true
    };
    $.fn.placeHolder = function () {
        var e = this;
        var t = e.attr("placeholder");
        if (t) e.val(t).css({
            color: "grey"
        });
        e.focus(function () {
            if (e.val() === t) e.css({
                color: "lightGrey"
            }).selectRange(0, 0).one("keydown", function () {
                e.val("").css({
                    color: "black"
                })
            })
        });
        e.blur(function () {
            if (e.val() == "" || e.val() === t) e.val(t).css({
                color: "grey"
            })
        });
        e.keyup(function () {
            if (e.val() == "") e.val(t).css({
                color: "lightGrey"
            }).selectRange(0, 0).one("keydown", function () {
                e.val("").css({
                    color: "black"
                })
            })
        });
        e.mouseup(function () {
            if (e.val() === t) e.selectRange(0, 0)
        })
    };
    $.fn.selectRange = function (e, t) {
        return this.each(function () {
            if (this.setSelectionRange) {
                this.setSelectionRange(e, t)
            } else if (this.createTextRange) {
                var n = this.createTextRange();
                n.collapse(true);
                n.moveEnd("character", t);
                n.moveStart("character", e);
                n.select()
            }
        })
    };
    $.fn.initField = function () {
        if ($(this).val() == "") {
            $(this).val($(this).attr("title"));
            $(this).addClass("grey")
        }
    };
    $.fn.ajaxForm = function (page, params, func, delay) {
        var formval = $(this).serializeObject();
        if (params != "") {
            formval = jQuery.extend(formval, params)
        }
        $.each(formval, function (e, t) {
            if (e.substr(0, 8) == "password") {
                if (t != "") {
                    formval[e] = md5(t)
                }
            }
        });
        page = "/" + parent + "/" + page;
        if (!$("#ajaxLoader").length) {
            $(document.body).append('<div id="ajaxLoader"></div>')
        }
        var loader = $("#ajaxLoader");
        var intervalId = 0;
        var timeOutId = 0;
        $.ajax({
            url: page,
            global: false,
            type: "POST",
            data: formval,
            async: true,
            dataType: "HTML",
            timeout: 3e4,
            beforeSend: function () {
                if (delay) {
                    if (params.message) {
                        loader.ajaxLoader(false, params.message, params.title)
                    } else {
                        loader.ajaxLoader("loader", "")
                    }
                }
                timeOutId = setTimeout(function () {
                    if (!delay) {
                        if (params.message && params.title) {
                            loader.ajaxLoader(false, params.message, params.title)
                        } else {
                            loader.ajaxLoader("loader", "")
                        }
                    }
                    loader.append($.getMessage().ajaxForm.loading);
                    intervalId = setInterval(function () {
                        loader.append(".")
                    }, 1e3)
                }, 200)
            },
            complete: function () {
                clearInterval(intervalId);
                clearTimeout(timeOutId)
            },
            success: function (msg) {
               // alert(JSON.stringify(msg));
                clearInterval(intervalId);
                clearTimeout(timeOutId);
                var response = jQuery.parseJSON(msg);
                if (!response || typeof response == "undefined") {
                    clearInterval(intervalId);
                    clearTimeout(timeOutId);
                    loader.ajaxLoader("error", $.getMessage().ajaxForm.error)
                } else if (response.func) {
                    eval(response.func)(response, loader)
                } else {
                    eval(func)(response, loader)
                }
            },
            error: function (e, t) {
                loader.ajaxLoader("error", $.getMessage().ajaxForm.error + "<br /> " + e.statusText)
            }
        })
    };
    $.fn.ajaxLoader = function (e, t) {
        $(this).dialog("destroy");
        $(this).dialog({
            autoOpen: false,
            modal: true,
            hide: "fade",
            position: ["center", 200],
            closeOnEscape: false,
            resizable: false,
            dialogClass: "ajaxLoader"
        });
        if (e == "loader") {
            $(this).dialog("option", "title", $.getMessage().ajaxLoader.loader.title);
            $(this).html($.getMessage().ajaxLoader.icon.circle + $.getMessage().ajaxLoader.loader.msg)
        } else if (e == "error") {
            $(this).dialog("option", "title", $.getMessage().ajaxLoader.error.title);
            $(this).dialog("option", "buttons", [{
                text: "Ok",
                click: function () {
                    $(this).dialog("close")
                }
            }]);
            $(this).html(t)
        } else {
            $(this).html($.getMessage().ajaxLoader.icon.circle);
            if (t != "") {
                $(this).append('<div style="width:100%;text-align:center">' + t + "</div>")
            }
        }
        $(this).dialog("open")
    };
    $.fn.imageRotate = function (e) {
        $(this).rotate({
            angle: e,
            animateTo: 720,
            duration: 3e3
        })
    };
    $.fn.TableSearch = function (e) {
        if ($(this).val() != "") {
            $("." + e + " tbody>tr").hide();
            $("." + e + " td:contains-ci('" + $(this).val() + "')").parent("tr").show()
        } else {
            $("." + e + " tbody>tr").show()
        }
    };
    $.extend($.expr[":"], {
        "contains-ci": function (e, t, n, r) {
            return (e.textContent || e.innerText || $(e).text() || "").toLowerCase().indexOf((n[3] || "").toLowerCase()) >= 0
        }
    });
    $.fn.sendToAjax = function (e) {
        e.preventDefault();
        $(".edit").each(function () {
            var e = $(this).attr("placeholder");
            if (e == $(this).val()) {
                $(this).val("")
            }
        });
        var t = $(this).closest("form");
        if (t.validationEngine("validate")) {
            t.validationEngine("hideAll");
            var n = {
                action: t.attr("id"),
                button: $(this).attr("id"),
                message: t.attr("title")
            };
            t.ajaxForm(t.attr("id").toLowerCase(), n, false, true)
        }
    };
    $.fn.showMessage = function (res) {
        $(this).dialog({
            autoOpen: false,
            modal: true,
            hide: "fade",
            position: ["center", 200],
            closeOnEscape: false,
            resizable: false
        });
        $(this).dialog("option", "title", res.title);
        if (res.action == "reload") {
            $(this).dialog("option", "buttons", [{
                text: $.getMessage().ok,
                click: function () {
                    $(this).dialog("close");
                    location.reload()
                }
            }])
        } else if (res.action == "download") {
            $(this).dialog("option", "buttons", [{
                text: $.getMessage().close,
                click: function () {
                    $(this).dialog("close")
                }
            }, {
                text: $.getMessage().download,
                click: function () {
                    var e = window.open();
                    e.location = res.location
                }
            }])
        } else if (res.action == "confirm") {
            $(this).dialog("option", "buttons", [{
                text: $.getMessage().yes,
                click: function () {
                    $(this).dialog("close");
                    $(res.formID).ajaxForm(res.page, res.params, res.func, true)
                }
            }, {
                text: $.getMessage().cancel,
                click: function () {
                    $(this).dialog("close")
                }
            }])
        } else if (res.location) {
            $(this).dialog("option", "buttons", [{
                text: $.getMessage().ok,
                click: function () {
                    $(this).dialog("close");
                    location.href = res.location
                }
            }])
        } else if (res.action = "redirect") {
            $(this).dialog("option", "buttons", [{
                text: $.getMessage().ok,
                click: function () {
                    $(this).dialog("close");
                    eval(res.redirect)(res)
                }
            }])
        } else {
            $(this).dialog("option", "buttons", [{
                text: $.getMessage().ok,
                click: function () {
                    $(this).dialog("close")
                }
            }])
        }
        $(this).html(res.message);
        $(this).dialog("open")
    };
    var loadMessage = function (e, t) {
        t.dialog("close");
        $("#messageDialog").dialog("destroy");
        if (!$("#messageDialog").length) {
            $(document.body).append('<div id="messageDialog"></div>')
        }
        $("#messageDialog").showMessage(e)
    };
    var refresh = function (e, t) {
        location.href = e.location
    };
    var downloadFile = function (e, t) {
        $.ajax({
            global: false,
            async: true,
            dataType: "HTML",
            timeout: 3e4,
            type: "POST",
            url: "/stream/download.ajax.php",
            data: {
                action: "download",
                id: did,
                key: key
            },
            success: function (e) {
                var t = jQuery.parseJSON(e);
                showDownload(t);
                if (!t || typeof t == "undefined") {
                    $("#dialog").html($.getMessage().ajaxForm.error + xhr.statusText);
                    $("#dialog").dialog("option", "buttons", [{
                        text: $.getMessage().ok,
                        click: function () {
                            $(this).dialog("close")
                        }
                    }])
                }
            },
            error: function (e, t) {
                $("#dialog").html($.getMessage().ajaxForm.error + e.statusText);
                $("#dialog").dialog("option", "buttons", [{
                    text: $.getMessage().ok,
                    click: function () {
                        $(this).dialog("close")
                    }
                }])
            }
        })
    };
    var updateElement = function (e, t) {
        t.dialog("close");
        $(e.element).html(e.html);
        $("#userFileUploadBut .button").attr('id',e.dir);
        if (e.breadcrumbs != "") {
            if ($("#breadcrumbs-header").css("height") != "124px") {
                $("#breadcrumbs-header").animate({
                    height: "124px"
                }, {
                    duration: 500,
                    complete: function () {
                        $("#breadcrumbs").html(e.breadcrumbs)
                    }
                })
            } else {
                $("#breadcrumbs").html(e.breadcrumbs)
            }
            
            if (e.uploadBut)
            {
               	$("#userFileUploadBut .button").fadeIn('slow');
            }
            else {
            	$("#userFileUploadBut .button").fadeOut('slow');
            }
            
        } else {
            $("#userFileUploadBut .button").hide();
            $("#breadcrumbs").html(e.breadcrumbs);
            $("#breadcrumbs-header").animate({
                height: "1px"
            }, {
                duration: 500
            })
        }
        if (e.editUser) {
            if ($("#custCreateBut").length) {
                $("#custCreateBut").fadeOut("slow", function () {
                    $("#userCreateBut").fadeIn("slow")
                });
                $("#userCreateBut > input").attr("id", e.editUser)
            }
        }
    };
    var loadForm = function (e, t) {
        t.dialog("close");
        $("#dialogWindow").html("");
        $("#dialogWindow").load(e.dialog, function () {
            if (e.formData) {
                $.each(e.formData[0], function (t, n) {
                    if ($(e.formID + ' input[name="' + t + '"]').prop("type") == "radio") {
                        $(e.formID + ' input[name="' + t + '"]').filter('[value="' + n + '"]').attr("checked", true)
                    } else if ($(e.formID + ' input[name="' + t + '"]').prop("type") == "checkbox") {
                        if (n == 1) {
                            $(e.formID + ' input[name="' + t + '"]').attr("checked", true)
                        } else {
                            $(e.formID + ' input[name="' + t + '"]').attr("checked", false)
                        }
                    } else {
                        if (n != "") {
                            $("#dialogWindow " + e.formID + " #" + t).val(n)
                        } else {
                            $("#dialogWindow " + e.formID + " #" + t).val("")
                        }
                        if ($("#dialogWindow " + e.formID + " #" + t).attr("readonly")) {}
                    }
                });
                $("#dialogWindow .formTitle").html(e.title)
            }
            $(".fancy-checkbox").after(function () {
                if ($(this).is(":checked")) {
                    return "<a href='#' class='toggle checked' ref='" + $(this).attr("id") + "'></a>"
                } else {
                    return "<a href='#' class='toggle' ref='" + $(this).attr("id") + "'></a>"
                }
            })
            
        });
        $("#dialogWindow").dialog({
            autoOpen: true,
            modal: true,
            hide: "fade",
            position: ["center", 100],
            width: "600px",
            closeOnEscape: true,
            resizable: false
        })
    };
    $(".button").live("mouseover", function (e) {
        $(this).addClass("selected").css("cursor", "pointer")
    }).live("mouseout", function (e) {
        $(this).removeClass("selected")
    });
    
 
    $(".dir").live("click", function (e) {
       e.preventDefault();
       readDir({
       	 dir: $(this).attr("href"),
       	 rel: $(this).attr("rel"),
       	 form: $(this)
       });
   
    });
    
    $(".closeUpload").live("click",function(e) {
    	e.preventDefault();
    	var f = $(this).closest("form");
    	var formval = f.serializeObject(); 
    	readDir({
    		 dir: formval.currentDir.substr(formval.currentDir.indexOf('/')),
    		 rel: formval.page,
    		 form: f
    	});
    });
    
    var readDir = function(e) {
    	if ($("#dialogWindow").dialog("isOpen")) {
    	    $("#dialogWindow").dialog("close")
    	}
    	var t = {
    	    action: "getDirList",
    	    message: $.getMessage().ajaxLoader.loader.msg,
    	    title: $.getMessage().ajaxLoader.loader.title,
    	    dir: e.dir,
    	    breadcrumbs: $("#breadcrumbs").html(),
    	    rel: e.rel
    	};
    	e.form.ajaxForm("dirlist", t);
    }
    
    
    $(".customerlist").live("click", function (e) {
        e.preventDefault();
        var t = {
            action: "getList",
            message: $.getMessage().ajaxLoader.loader.msg,
            title: $.getMessage().ajaxLoader.loader.title,
            id: $(this).attr("id"),
            breadcrumbs: $("#breadcrumbs").html(),
            type: $(this).attr("rel"),
            href: $(this).attr("href")
        };
        $(this).ajaxForm("custlist", t)
    });
    
   
    
    var customerList = function (e) {
        if ($("#dialogWindow").dialog("isOpen")) {
            $("#dialogWindow").dialog("close")
        }
        var t = {
            action: "getList",
            message: $.getMessage().ajaxLoader.loader.msg,
            title: $.getMessage().ajaxLoader.loader.title,
            id: e.id,
            breadcrumbs: $("#breadcrumbs").html(),
            type: e.rel,
            href: e.href
        };
        $(this).ajaxForm("custlist", t)
    };
    
    
    $(".file").live("click", function (e) {
        e.preventDefault();
        var t = {
            action: "downloadFile",
            message: $.getMessage().ajaxLoader.loader.msg,
            title: $.getMessage().ajaxLoader.loader.title,
            file: $(this).attr("href"),
            rel: $(this).attr("rel")
        };
        $(this).ajaxForm("dirlist", t)
    });
    $(".close").live("click", function (e) {
        e.preventDefault();
        $("#dialogWindow").dialog("close")
    });
    $(".editDialog").live("click", function (e) {
        e.preventDefault();
        var t = $(this).closest("form");
        var n = {
            action: $(this).attr("rel"),
            id: $(this).attr("id"),
            message: t.attr("title"),
            title: $.getMessage().ajaxLoader.loader.title
        };
        t.ajaxForm(t.attr("id").toLowerCase(), n, false, true)
    });
    $("#filelist > tbody > tr,#customerList > tbody > tr ").live("mouseover", function () {
        $(this).children().css({
            background: "#666",
            color: "#FFFFFF"
        });
        $(this).children().children().css({
            color: "#FFFFFF"
        })
    }).live("mouseout", function () {
        $(this).children().css({
            background: "",
            color: "#000000"
        });
        $(this).children().children().css({
            color: "#000000"
        })
    });
    $(".toggle").live("click", function (e) {
        var t = $("#" + $(this).attr("ref"));
        if (t.is(":checked")) {
            t.removeAttr("checked")
        } else {
            t.attr("checked", "true")
        }
        $(this).toggleClass("checked");
        e.preventDefault()
    });
    $(".send").live("click", function (e) {
        $(this).sendToAjax(e)
    })
})(jQuery);
$(document).ready(function () {
    $("#search").on("keyup", function () {
        var e = $(this).val().toLowerCase();
        $("table tr").each(function (t) {
            if (t !== 0) {
                $row = $(this);
                var n = $row.find("td:first").text().toLowerCase();
                if (n.indexOf(e) !== 0) {
                    $row.hide()
                } else {
                    $row.show()
                }
            }
        })
    });
    $("#search").keyup(function () {
        $(this).TableSearch("searchTable")
    });
    if ($("#search").length) {
        $("#search").TableSearch("searchTable")
    }
    $(".loginform").show("drop", {
        direction: "up"
    }, 1500);
    $(".resetform").hide().show("fade", "slow");
    $(".search").click(function (e) {
        e.preventDefault();
        var t = $(this).closest("form");
        var n = {
            action: t.attr("id"),
            message: t.attr("title"),
            title: $.getMessage().ajaxLoader.loader.title,
            rel: $(this).attr("rel")
        };
        t.ajaxForm(t.attr("id").toLowerCase(), n)
    });
    $(".reset").click(function (e) {
        e.preventDefault();
        var t = $(this).closest("form");
        t.validationEngine("hideAll");
        t.clearForm();
        $(".edit").each(function () {
            $(this).initField()
        });
        return false
    });
    $("#signout").click(function (e) {
        e.preventDefault();
        var t = {
            action: $(this).attr("id"),
            message: $.getMessage().signout.msg
        };
        $(this).ajaxForm("signout", t, false, true)
    });
    $("#dialog").keypress(function (e) {
        if (e.which == 13) {
            $("#dialog .send").click()
        }
    });
    $(".closeButton").click(function (e) {
        e.preventDefault();
        var t = $(this).closest("form");
        t.validationEngine("hideAll");
        $("#" + $(this).parent().attr("id")).dialog("close")
    });
    $("#user_code").keydown(function (e) {
        $(this).css({
            "text-transform": "uppercase"
        });
        if (e.keyCode == 32) {
            e.preventDefault()
        }
        if ((e.keyCode < 48 || e.keyCode > 57) && (e.keyCode < 96 || e.keyCode > 105)) {} else {
            e.preventDefault()
        }
    });
    $("#refresh").click(function (e) {
        e.preventDefault();
        d = new Date;
        $("#captcha").attr("src", "/stream/visual-captcha.php?" + d.getTime())
    });
    if ($(".wheel").length) {
        $(".wheel").imageRotate()
    }
    var e = "placeholder" in document.createElement("input");
    if (!e) {
        $(":input").each(function () {
            if ($(this).val == "") {
                $(this).placeHolder()
            }
        })
    }
    $(["../images/ajax-loader.gif"]).preload()
})